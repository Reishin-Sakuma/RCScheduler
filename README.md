# RCScheduler (Windows用Robocopyスケジューラソフト)

このアプリケーションは、Microsoft Windowsのタスクスケジューラを利用して、Robocopyによるフォルダのバックアップを簡単に設定・管理できるGUIツールです。ネットワークパス認証、フレキシブルなメール通知機能、実行ログの保存、タスク履歴の有効化など、多機能なバックアップスケジューラを直感的に操作できます。

---

## 主な機能

### 🔄 バックアップ機能
* Robocopyによるフォルダバックアップの自動化
* ミラーモード（/MIR）とサブディレクトリコピー（/E）の選択
* NTFS権限のコピー（/SEC）対応
* カスタムオプションの追加
* リトライ回数・間隔の設定

### 📅 スケジュール機能  
* タスクスケジューラを使った定期実行（毎日／毎週）
* 実行時刻の詳細設定
* タスク名の自動生成機能

### 🌐 ネットワーク対応
* **ネットワークパス認証機能**（新機能）
  * ユーザー名・パスワード・ドメイン設定
  * コピー元・コピー先それぞれの認証設定
  * 接続テスト機能

### 📧 メール通知機能
* **フレキシブルなSMTP認証対応**（拡張機能）
  * 認証方式: CRAM-MD5, LOGIN, PLAIN, DIGEST-MD5
  * 接続の保護: 暗号化なし, STARTTLS, SSL/TLS
  * Gmail、Outlook、独自SMTPサーバーに対応
  * SMTP接続テスト・メールテスト機能

### 🛠️ 管理・テスト機能
* **バッチスクリプトテスト機能**（新機能）
* **タスク履歴の有効化・無効化機能**（管理者権限対応）
* 実行ログの表示・保存
* タスクステータスの確認・更新

### 🖥️ ユーザーインターフェース
* GUIで簡単に設定・管理
* スクロール対応の設定画面
* リアルタイムログ表示

---

## 動作環境

* **OS**: Windows 10 以降（タスクスケジューラが使用可能な環境）
* **Python**: Python 3.8 以降
* **権限**: 一部機能で管理者権限が必要（タスク履歴設定など）
* **ネットワーク**: ネットワークパス使用時は適切な認証情報が必要

---

## インストール方法

### 1. Pythonのインストール
[Python公式サイト](https://www.python.org) からPython 3.8以降をダウンロード・インストールしてください。

### 2. 必要パッケージの確認
ほとんどのWindows環境では `tkinter` は標準でインストールされています。不足している場合は以下でインストール：

```bash
pip install tk
```

### 3. プログラムのダウンロード
GitHubからソースコードをダウンロードし、適当なフォルダに展開してください。

---

## 使い方

### 🚀 初回起動

```bash
python RCScheduler.py
```

### ⚙️ 基本設定手順

#### 1. **フォルダ設定**
- **コピー元フォルダ**: バックアップしたいフォルダを選択
- **コピー先フォルダ**: バックアップ先のフォルダを選択

#### 2. **ネットワークパス認証設定**（必要に応じて）
ネットワークパス（`\\server\share`形式）を使用する場合：
- **ユーザー名**: ネットワークリソースへのアクセス用ユーザー名
- **パスワード**: 対応するパスワード  
- **ドメイン**: ドメイン環境の場合はドメイン名
- **接続テスト**: 設定した認証情報の動作確認

#### 3. **Robocopyオプション設定**
- **コピーモード**:
  * `/MIR` - ミラーモード（削除も同期、完全同期）
  * `/E` - サブディレクトリコピー（削除なし）
- **その他オプション**:
  * `/NP` - 進行状況を表示しない
  * `/NDL` - ディレクトリリストを表示しない  
  * `/SEC` - NTFS権限もコピー
  * `/L` - テストモード（実際にコピーしない）
- **詳細設定**:
  * リトライ回数・間隔
  * ログファイル保存先
  * 追加オプション

#### 4. **スケジュール設定**
- **実行頻度**: 毎日 または 毎週
- **曜日**: 毎週実行の場合に選択
- **実行時刻**: 時間と分を指定
- **タスク名**: 自動生成 または 手動入力

#### 5. **メール通知設定**（オプション）
実行結果をメールで受け取りたい場合：

**基本設定**:
- **SMTPサーバー**: `smtp.gmail.com` など
- **ポート**: `587`（STARTTLS）、`465`（SSL/TLS）など
- **接続の保護**: 
  * `暗号化なし` - 暗号化しない（非推奨）
  * `STARTTLS` - 一般的な暗号化方式  
  * `SSL/TLS` - より強固な暗号化
- **認証方式**: 
  * `CRAM-MD5` - 推奨方式
  * `LOGIN` - 一般的な方式
  * `PLAIN` - 平文認証
  * `DIGEST-MD5` - MD5ハッシュ認証

**認証情報**:
- **送信者メール**: 送信に使用するメールアドレス
- **送信者パスワード**: アプリパスワードまたはアカウントパスワード
- **送信先メール**: 通知を受け取るメールアドレス

**Gmail使用時の注意**: 2段階認証を有効にして「アプリパスワード」を生成してください。

#### 6. **設定の保存とテスト**
- **設定を保存**: 現在の設定を設定ファイルに保存
- **バッチテスト**: 生成されるバッチスクリプトの動作確認
- **今すぐ実行**: 設定内容でバックアップを即座に実行

#### 7. **タスクの登録**
- **タスク作成/更新**: Windowsタスクスケジューラにバックアップタスクを登録
- **タスク削除**: 登録済みタスクの削除

---

## 🔧 高度な機能

### タスク履歴設定
Windowsタスクスケジューラの履歴機能を制御：
- **管理者権限が必要**
- UACダイアログが表示される場合があります
- 「現在の設定確認」で現在の状態を確認可能

### バッチスクリプトテスト
タスクスケジューラに登録する前にバッチスクリプトの動作確認：
- 実際のRobocopyコマンドが実行されます
- 実行結果はコマンドプロンプトとログファイルで確認
- テスト後にファイル削除の選択が可能

### 詳細ログ機能  
- 実行毎に一意なログファイル名を自動生成
- SJIS(CP932)エンコーディングで日本語対応
- ネットワーク認証からクリーンアップまでの全プロセスを記録

---

## 📋 スケジュール実行時の動作

タスクスケジューラから実行される際は、以下の流れで動作します：

1. **ネットワーク認証**: 必要に応じてネットワークパスに認証
2. **フォルダアクセス確認**: コピー元・先のアクセス可能性確認
3. **Robocopy実行**: 設定されたオプションでバックアップ実行
4. **メール通知**: 結果を設定されたメールアドレスに送信
5. **クリーンアップ**: ネットワーク接続切断、一時ファイル削除

---

## ⚠️ 注意事項・セキュリティ

### セキュリティ関連
* **パスワード保存**: メール・ネットワーク認証のパスワードは設定ファイルに**平文で保存**されます
* **ファイル保護**: 設定ファイル（`robocopy_config.json`）のアクセス権限にご注意ください
* **実運用環境**: セキュリティが重要な環境では暗号化対応を検討してください

### 権限関連
* **管理者権限**: タスク履歴の有効化など一部機能で必要
* **ネットワークアクセス**: ネットワークパス使用時は適切な権限が必要

### Robocopy戻り値
* **正常範囲**: 戻り値 `0〜7` は正常終了として扱われます
* **エラー**: 戻り値 `8以上` はエラーとして扱われます

---

## 🚨 トラブルシューティング

### よくある問題と解決法

#### **メール送信に失敗する**
1. **Gmail使用時**: 
   - 2段階認証を有効にしてアプリパスワードを生成
   - 「安全性の低いアプリ」設定は非推奨
2. **接続設定**: 
   - SMTP接続テストで基本接続を確認
   - 接続の保護・認証方式を変更して試行
3. **ファイアウォール**: 
   - SMTPポートがブロックされていないか確認

#### **ネットワークパスに接続できない**
1. **認証情報**: ユーザー名・パスワード・ドメインを確認
2. **接続テスト**: GUI上の「接続テスト」で事前確認
3. **ネットワーク**: サーバーへのネットワーク接続を確認

#### **タスクが実行されない**  
1. **タスクステータス**: 「ステータス更新」で現在の状態確認
2. **ログファイル**: 生成されたログファイルでエラー内容確認
3. **管理者権限**: タスクスケジューラで管理者権限で実行設定

#### **文字化けが発生する**
1. **日本語環境**: WindowsがSJIS(CP932)に対応しているか確認
2. **ログファイル**: Shift_JISまたはCP932で開いてください

---

## 📁 生成されるファイル

### 設定ファイル
* `robocopy_config.json` - 全設定情報（パスワード含む）

### 実行ファイル
* `[タスク名].bat` - メインバッチスクリプト  
* `[タスク名]_batch_mail.ps1` - メール送信用PowerShellスクリプト

### ログファイル
* `robocopy_log_YYYYMMDD_HHMMSS.txt` - 実行ログ（日時付き）

---

## 🔄 更新履歴

### Version 1.0.0
- 基本的なRobocopyスケジュール機能
- **ネットワークパス認証機能追加**
- **フレキシブルSMTP認証対応**  
- **バッチスクリプトテスト機能追加**
- **タスク履歴設定機能追加**
- **タスク名自動生成機能追加**
- **詳細ログ機能強化**

---

## 📄 ライセンス

このプロジェクトはMITライセンスのもとで提供されています。

---

## 🤖 開発について

ソースコードは生成AI「Claude」「ChatGPT」により生成・改良されたものです。

---

## 📞 サポート・フィードバック

バグ報告や機能要望は、GitHubのIssuesページからお願いします。

---

## 💡 使用例

### 例1: 社内ファイルサーバーの定期バックアップ
```
コピー元: \\fileserver\shared\documents
コピー先: D:\backup\documents  
認証: domain\username / password
スケジュール: 毎日 2:00AM
メール通知: 有効
```

### 例2: 個人PCの重要フォルダバックアップ  
```
コピー元: C:\Users\username\Documents
コピー先: E:\backup\documents
スケジュール: 毎週日曜日 1:00AM  
オプション: /MIR（ミラーモード）
```

### 例3: 外部NASへのバックアップ
```
コピー元: C:\Projects
コピー先: \\nas.local\backup\projects
認証: nasuser / password
スケジュール: 毎日 6:00PM
メール通知: Gmail（アプリパスワード使用）
```